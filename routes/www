var express = require('express');
var request = require('request');
var www = express.Router();

/* GET home page. */
www.get('/', function(req, res, next) {
    console.log("Serving: ", req.headers.host);
  res.render('coming-soon', { title: 'www - Coming Soon' });
});

www.all(
    "/webhook",
    function (req, res) {
        console.log("recieved message");
        var url  = "https://discordapp.com/api/webhooks/459889615550152705/U_RG_4r8FyBacP0l0VMRcb0i7co1ot0NPzeQOpz0JSNLbVcflJMa4sYUUrAgGwfSbmyw/slack";
        var json = {
            text:  "Help! Robot down with no power at co-ordinates: " + req.query.coordinates,
            title: "Robot: " + req.query.robotname
        };
        var requestOptions= {
            url:  url,
                body: json,
                json:true
        };
        console.log("passing message on: ", requestOptions);
        request(requestOptions, function(err, response, body){
            console.log(err);
            console.log(response);
            console.log(body);
            return res.send("message managed")
        });
    }
);


module.exports = www;
